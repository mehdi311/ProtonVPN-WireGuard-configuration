name: ProtonVPN Config Downloader

# ØªØ¹ÛŒÛŒÙ† Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± (Ù…Ø«Ù„Ø§Ù‹ Ù‡Ø± Ø±ÙˆØ² Ø¯Ø± Ø³Ø§Ø¹Øª 00:00 UTC)
on:
  workflow_dispatch:
  schedule:
    # 0 0 * * * corresponds to 12:00 AM UTC
    - cron: '0 0 * * *'

jobs:
  download_and_send:
    # Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø§ÙˆØ¨ÙˆÙ†ØªÙˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒ Ø´ÙˆØ¯
    runs-on: ubuntu-latest

    # ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù„ Job
    env:
      VPN_USERNAME: ${{ secrets.VPN_USERNAME }}
      VPN_PASSWORD: ${{ secrets.VPN_PASSWORD }}
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      PYTHONUNBUFFERED: 1 # Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø®Ø±ÙˆØ¬ÛŒ Ù„Ø§Ú¯ Ø¨Ù‡ ØµÙˆØ±Øª Ù„Ø­Ø¸Ù‡ Ø§ÛŒ

    steps:
    - name: â¬‡ï¸ Checkout Repository
      uses: actions/checkout@v4

    - name: ğŸ Setup Python 3.10
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'

    - name: ğŸ“¦ Install Python Dependencies & Chrome Driver
      run: |
        # Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬ Ù‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†
        pip install selenium requests
        
        # Ù†ØµØ¨ Ù…Ø±ÙˆØ±Ú¯Ø± Ú©Ø±ÙˆÙ… Ùˆ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ù‡Ø§ÛŒ Headless
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
        
        # Ù†ØµØ¨ WebDriver Ø¨Ø±Ø§ÛŒ Selenium
        # Selenium Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± WebDriver Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù†Ø³Ø®Ù‡ Ú©Ø±ÙˆÙ… Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…ÛŒ Ú©Ù†Ø¯ØŒ
        # Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ùˆ Ù…Ø­ÛŒØ· Ù‡Ø§ÛŒ Ø®Ø§ØµØŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ±Ø§Øª Ø±Ø§ Ù†Ú¯Ù‡ Ù…ÛŒ Ø¯Ø§Ø±ÛŒÙ….
        pip install webdriver-manager
        
    - name: âš™ï¸ Clear Previous Logs/Configs (Prevent Duplicates if run manually)
      run: |
        rm -rf downloaded_configs
        rm -f downloaded_server_ids.json
        mkdir -p downloaded_configs

    - name: ğŸš€ Run ProtonVPN Downloader Script
      # Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø§ÛŒØªÙˆÙ† Ú©Ù‡ Ø´Ø§Ù…Ù„ ØªÙ…Ø§Ù… Ù…Ù†Ø·Ù‚ Ø¯Ø§Ù†Ù„ÙˆØ¯ØŒ
      # Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø´Ù†ØŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÚ©Ø±Ø§Ø±ØŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø³Øª.
      run: python3 proton_downloader_chrome.py

    # Ù†Ú©ØªÙ‡: Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø´Ù„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ zip Ú©Ø±Ø¯Ù† Ùˆ Ø§Ø±Ø³Ø§Ù„ Ù†ÛŒØ³ØªØŒ
    # Ø²ÛŒØ±Ø§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø§ÛŒØªÙˆÙ† (organize_and_send_files) Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù¾Ø³ Ø§Ø² 
    # Ø§ØªÙ…Ø§Ù… ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ù„ÙˆØ¯Ù‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒ Ø¯Ù‡Ø¯.

    # Ù…Ø±Ø­Ù„Ù‡ ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø± Ù¾Ø§ÛŒØªÙˆÙ† Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ØŒ 
    # Ø§Ù…Ø§ Ø§Ú¯Ø± ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ Ù‡Ø§ Ø¯Ø± Artifacts Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù…ÛŒ ØªÙˆØ§Ù†ÛŒØ¯ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯:
    # - name: ğŸ“¦ Archive Logs (Optional)
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: downloaded-logs
    #     path: downloaded_server_ids.json
